{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico</title>
    <link rel="icon" href ="{% static 'icones-site/logo-h-pequena.png' %}">
    <link rel="stylesheet" href="{% static 'css/usuario/historico.css' %}">
    <script src="{% static 'js/usuario/menu.js' %}"></script>
    <script src="{% static 'js/usuario/notificacao.js' %}"></script>
</head>
<body>
    <header>
        <div class="seta-voltar">
            <a href="javascript:history.back()">
                <img src="{% static 'icones-site/seta-voltar.png' %}" alt="Ícone seta voltar">
            </a>
        </div>
        <div class="logo-h">
          <a href="{% url 'feed' %}"><img src="{% static 'icones-site/logo-h.png' %}" alt="Logo Habitus"></a>
        </div>
        <div class="menu-icon" onclick="toggleMenu()">
          <img id="menu-icon" src="{% static 'icones-site/menu-lateral.png' %}" alt="Abrir Menu">
        </div>
    </header>
      
{% if user.is_authenticated %}
        {% if user.groups.first.name == "Aluno" %}
            <!-- MENU PARA ALUNO -->
            <nav id="menu-lateral" class="menu-lateral">
                <div class="fechar">
                    <h1>Menu</h1>
                    <button class="fechar-menu" onclick="toggleMenu()">✕</button>
                </div>
                <ul>
                    <div>
                        <li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/ultimas-noticias.png' %}" alt="">Últimas notícias</a></li>
                        <li><a href="{% url 'notificacoes' %}"><img src="{% static 'icones-site/notificacoes.png' %}" alt="">Notificações</a></li>
                        <li><a href="{% url 'historico' %}"><img src="{% static 'icones-site/historico.png' %}" alt="">Histórico</a></li>
                        <li><a href="{% url 'solicitar_novo_treino' %}"><img src="{% static 'icones-site/solicitar-treino.png' %}" alt="">Solicitar novo treino</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'configuracoes' %}"><img src="{% static 'icones-site/configuracoes.png' %}" alt="">Configurações</a></li>
                        <!--<li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/icone-avaliar.png' %}" alt="">Avaliar</a></li>-->
                        <li><a href="{% url 'reportar_erro' %}"><img src="{% static 'icones-site/reportar-erro.png' %}" alt="">Reportar erro</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'desenvolvedores' %}"><img src="{% static 'icones-site/desenvolvedores.png' %}" alt="">Desenvolvedores</a></li>
                        <li><a href="{% url 'sobre_habitus' %}"><img src="{% static 'icones-site/sobre.png' %}" alt="">Sobre o Habitus</a></li>
                    </div>
                </ul>
            </nav>

        {% elif user.groups.first.name == "Professor" %}
            <!-- MENU PARA PROFESSOR -->
            <nav id="menu-lateral" class="menu-lateral">
                <div class="fechar">
                    <h1>Menu</h1>
                    <button class="fechar-menu" onclick="toggleMenu()">✕</button>
                </div>
                <ul>
                    <div>
                        <li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/ultimas-noticias.png' %}" alt="">Últimas notícias</a></li>
                        <li><a href="{% url 'notificacoes' %}"><img src="{% static 'icones-site/notificacoes.png' %}" alt="">Notificações</a></li>
                        <li><a href="{% url 'historico' %}"><img src="{% static 'icones-site/historico.png' %}" alt="">Histórico</a></li>
                        <li><a href="{% url 'solicitar_novo_treino' %}"><img src="{% static 'icones-site/solicitar-treino.png' %}" alt="">Solicitar novo treino</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'gerenciar_alunos' %}"><img src="{% static 'icones-site/icone-alunos.png' %}" alt="">Alunos</a></li>
                        <li><a href="{% url 'gerenciar_noticias' %}"><img src="{% static 'icones-site/icone-noticias.png' %}" alt="">Notícias</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'configuracoes' %}"><img src="{% static 'icones-site/configuracoes.png' %}" alt="">Configurações</a></li>
                        <!--<li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/icone-avaliar.png' %}" alt="">Avaliar</a></li>-->
                        <li><a href="{% url 'reportar_erro' %}"><img src="{% static 'icones-site/reportar-erro.png' %}" alt="">Reportar erro</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'desenvolvedores' %}"><img src="{% static 'icones-site/desenvolvedores.png' %}" alt="">Desenvolvedores</a></li>
                        <li><a href="{% url 'sobre_habitus' %}"><img src="{% static 'icones-site/sobre.png' %}" alt="">Sobre o Habitus</a></li>
                    </div>
                </ul>
            </nav>

        {% elif user.groups.first.name == "Admin" %}
            <!-- MENU PARA ADMIN -->
            <nav id="menu-lateral" class="menu-lateral">
                <div class="fechar">
                    <h1>Menu</h1>
                    <button class="fechar-menu" onclick="toggleMenu()">✕</button>
                </div>
                <ul>
                    <div>
                        <li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/ultimas-noticias.png' %}" alt="">Últimas notícias</a></li>
                        <li><a href="{% url 'notificacoes' %}"><img src="{% static 'icones-site/notificacoes.png' %}" alt="">Notificações</a></li>
                        <li><a href="{% url 'historico' %}"><img src="{% static 'icones-site/historico.png' %}" alt="">Histórico</a></li>
                        <li><a href="{% url 'solicitar_novo_treino' %}"><img src="{% static 'icones-site/solicitar-treino.png' %}" alt="">Solicitar novo treino</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'gerenciar_alunos' %}"><img src="{% static 'icones-site/icone-alunos.png' %}" alt="">Alunos</a>
                        <li><a href="{% url 'exercicios' %}"><img src="{% static 'icones-site/icone-exercicios.png' %}" alt="">Exercícios</a></li>
                        <li><a href="{% url 'gerenciar_noticias' %}"><img src="{% static 'icones-site/icone-noticias.png' %}" alt="">Notícias</a></li>
                        <li><a href="{% url 'professores' %}"><img src="{% static 'icones-site/icone-professores.png' %}" alt="">Professores</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'configuracoes' %}"><img src="{% static 'icones-site/configuracoes.png' %}" alt="">Configurações</a></li>
                        <!--<li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/icone-avaliar.png' %}" alt="">Avaliações</a></li>-->
                        <li><a href="{% url 'reportar_erro' %}"><img src="{% static 'icones-site/reportar-erro.png' %}" alt="">Reportar erro</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'desenvolvedores' %}"><img src="{% static 'icones-site/desenvolvedores.png' %}" alt="">Desenvolvedores</a></li>
                        <li><a href="{% url 'sobre_habitus' %}"><img src="{% static 'icones-site/sobre.png' %}" alt="">Sobre o Habitus</a></li>
                    </div>
                </ul>
            </nav>
        {% endif %}
    {% endif %}

    <main>
        <section class="nome-pagina">
            <h1>Histórico</h1>
        </section>
        <section class="container">
            <section class="filtros">
                <!-- Busca por nome -->
                <div class="filtro busca">
                    <input type="text" id="buscar-nome" placeholder="Busque seu treino pelo nome">
                    <img src="{% static 'icones-site/lupa.png' %}" alt="Buscar">
                </div>

                <!-- Filtro por data -->
                <div class="filtro datas">
                    <input type="date" id="data-inicio" placeholder="Data início">
                    <input type="date" id="data-fim" placeholder="Data fim">

                </div>

                <!-- Filtro por nível -->
                <div class="filtro nivel">
                    <select id="filtro-nivel">
                        <option value="">Filtre pelo nível</option>
                        <option value="I">Iniciante</option>
                        <option value="M">Intermediário</option>
                        <option value="A">Avançado</option>
                    </select>
                </div>
            </section>

            {% if treinos %}
                {% for treino in treinos %}
                    <div class="card-treino" data-inicio="{{ treino.data_inicio }}" data-fim="{{ treino.data_fim }}" data-nivel="{{ treino.nivel }}">
                        <div class="info-treino">
                            <h2>{{ treino.nome }}</h2>
                            <p>{{ treino.exercicios_treino.count }} Exercício(s)</p>
                        </div>
                        <div class="datas">
                            <div>
                                <strong>Data início:</strong>
                                <p>{{ treino.data_inicio|date:"d/m/Y" }}</p>
                            </div>
                            <div>
                                <strong>Data fim:</strong>
                                <p>{{ treino.data_fim|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                        <div class="status-arquivado">
                            Treino arquivado!
                        </div>
                        <div class="acoes">
                            <a href="{% url 'detalhes_treino' treino.id %}" class="btn-detalhar">Detalhar treino</a>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="nenhum-treino">Você ainda não possui treinos arquivados.</p>
            {% endif %}

        </section>
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            const inputBusca = document.getElementById("buscar-nome");
            const dataInicio = document.getElementById("data-inicio");
            const dataFim = document.getElementById("data-fim");
            const filtroNivel = document.getElementById("filtro-nivel");
            const cards = document.querySelectorAll(".card-treino");

            function filtrar() {
                cards.forEach(card => {
                    const nome = card.querySelector("h2").innerText.toLowerCase();
                    const nivel = card.getAttribute("data-nivel"); // vamos adicionar no HTML
                    const dataInicioTreino = new Date(card.getAttribute("data-inicio"));
                    const dataFimTreino = new Date(card.getAttribute("data-fim"));

                    let exibir = true;

                    // Filtro por busca
                    if (inputBusca.value && !nome.includes(inputBusca.value.toLowerCase())) {
                        exibir = false;
                    }

                    // Filtro por nível
                    if (filtroNivel.value && filtroNivel.value !== nivel) {
                        exibir = false;
                    }

                    // Filtro por datas
                    if (dataInicio.value) {
                        let filtroInicio = new Date(dataInicio.value);
                        if (dataInicioTreino < filtroInicio) exibir = false;
                    }

                    if (dataFim.value) {
                        let filtroFim = new Date(dataFim.value);
                        if (dataFimTreino > filtroFim) exibir = false;
                    }

                    card.style.display = exibir ? "block" : "none";
                });
            }

            inputBusca.addEventListener("input", filtrar);
            dataInicio.addEventListener("change", filtrar);
            dataFim.addEventListener("change", filtrar);
            filtroNivel.addEventListener("change", filtrar);
        });
        </script>

        
        <menu>
            <div>
            <a href="{% url 'feed' %}">
                <img src="{% static 'icones-site/feed-icon-preta.png' %}" alt="Logo feed">
                <h3>Feed</h3>
            </a>
            </div>
            <div>
                <a href="{% url 'treinos' %}">
                    <img src="{% static 'icones-site/treino-icon-preta.png' %}" alt="icone treino">
                    <h3>Treinos</h3>
                </a>
            </div>
            <div>
                <a href="{% url 'perfil' %}">
                    <img src="{% static 'icones-site/perfil-icon-preta.png' %}" alt="Logo perfil">
                    <h3>Perfil</h3>
                </a>
            </div>
    </main>
    
    </menu>
</body>
</html>
