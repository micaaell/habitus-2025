{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professor</title>
    <link rel="icon" href ="{% static 'icones-site/logo-h-pequena.png' %}">
    <link rel="stylesheet" href="{% static 'css/admin/professor.css' %}">
    <script src="{% static 'js/usuario/menu.js' %}"></script>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fotoUpload = document.getElementById('foto-upload');
            const fotoForm = document.getElementById('foto-form');
            const messageDiv = document.getElementById('foto-message');

            // Quando clicar na foto (ou no ícone de edição)
            document.querySelector('.foto-wrapper').addEventListener('click', function(e) {
                e.preventDefault();
                fotoUpload.click(); // Abre o seletor de arquivos
            });

            // Quando selecionar uma nova foto
            fotoUpload.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    // Pré-visualização
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('foto-professor').src = e.target.result;

                        // Envia o formulário automaticamente
                        const formData = new FormData(fotoForm);
                        fetch(fotoForm.action, {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'X-CSRFToken': '{{ csrf_token }}'
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            showMessage(data.message, data.success);
                        })
                        .catch(error => {
                            showMessage('', false);
                        });
                    };
                    reader.readAsDataURL(this.files[0]);
                }
            });

            function showMessage(message, isSuccess) {
                messageDiv.textContent = message;
                messageDiv.style.backgroundColor = isSuccess ? '#4CAF50' : '#F44336';
                messageDiv.style.display = 'block';

                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            }
        });
    </script>
    <script>
        function confirmarAcao(acao) {
            const mensagem = acao === 'inativar' 
                ? 'Tem certeza que deseja inativar a conta deste professor? Esta ação impedirá que ele acesse o sistema.'
                : 'Tem certeza que deseja reativar a conta deste professor? Ele voltará a ter acesso ao sistema.';

            if (confirm(mensagem)) {
                document.getElementById('status-form').submit();
            }
        }
    </script>
    <header>
        <div class="seta-voltar">
            <a href="javascript:history.back()">
                <img src="{% static 'icones-site/seta-voltar.png' %}" alt="Ícone seta voltar">
            </a>
        </div>
        <div class="logo-h">
          <a href="{% url 'feed' %}"><img src="{% static 'icones-site/logo-h.png' %}" alt="Logo Habitus"></a>
        </div>
        <div class="menu-icon" onclick="toggleMenu()">
          <img id="menu-icon" src="{% static 'icones-site/menu-lateral.png' %}" alt="Abrir Menu">
        </div>
    </header>
      
    {% if user.is_authenticated %}
        {% if user.groups.first.name == "Aluno" %}
            <!-- MENU PARA ALUNO -->
            <nav id="menu-lateral" class="menu-lateral">
                <div class="fechar">
                    <h1>Menu</h1>
                    <button class="fechar-menu" onclick="toggleMenu()">✕</button>
                </div>
                <ul>
                    <div>
                        <li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/ultimas-noticias.png' %}" alt="">Últimas notícias</a></li>
                        <li><a href="{% url 'notificacoes' %}"><img src="{% static 'icones-site/notificacoes.png' %}" alt="">Notificações</a></li>
                        <li><a href="{% url 'historico' %}"><img src="{% static 'icones-site/historico.png' %}" alt="">Histórico</a></li>
                        <li><a href="{% url 'solicitar_novo_treino' %}"><img src="{% static 'icones-site/solicitar-treino.png' %}" alt="">Solicitar novo treino</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'configuracoes' %}"><img src="{% static 'icones-site/configuracoes.png' %}" alt="">Configurações</a></li>
                        <!--<li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/icone-avaliar.png' %}" alt="">Avaliar</a></li>-->
                        <li><a href="{% url 'reportar_erro' %}"><img src="{% static 'icones-site/reportar-erro.png' %}" alt="">Reportar erro</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'desenvolvedores' %}"><img src="{% static 'icones-site/desenvolvedores.png' %}" alt="">Desenvolvedores</a></li>
                        <li><a href="{% url 'sobre_habitus' %}"><img src="{% static 'icones-site/sobre.png' %}" alt="">Sobre o Habitus</a></li>
                    </div>
                </ul>
            </nav>

        {% elif user.groups.first.name == "Professor" %}
            <!-- MENU PARA PROFESSOR -->
            <nav id="menu-lateral" class="menu-lateral">
                <div class="fechar">
                    <h1>Menu</h1>
                    <button class="fechar-menu" onclick="toggleMenu()">✕</button>
                </div>
                <ul>
                    <div>
                        <li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/ultimas-noticias.png' %}" alt="">Últimas notícias</a></li>
                        <li><a href="{% url 'notificacoes' %}"><img src="{% static 'icones-site/notificacoes.png' %}" alt="">Notificações</a></li>
                        <li><a href="{% url 'historico' %}"><img src="{% static 'icones-site/historico.png' %}" alt="">Histórico</a></li>
                        <li><a href="{% url 'solicitar_novo_treino' %}"><img src="{% static 'icones-site/solicitar-treino.png' %}" alt="">Solicitar novo treino</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'gerenciar_alunos' %}"><img src="{% static 'icones-site/icone-alunos.png' %}" alt="">Alunos</a></li>
                        <li><a href="{% url 'gerenciar_noticias' %}"><img src="{% static 'icones-site/icone-noticias.png' %}" alt="">Notícias</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'configuracoes' %}"><img src="{% static 'icones-site/configuracoes.png' %}" alt="">Configurações</a></li>
                        <!--<li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/icone-avaliar.png' %}" alt="">Avaliar</a></li>-->
                        <li><a href="{% url 'reportar_erro' %}"><img src="{% static 'icones-site/reportar-erro.png' %}" alt="">Reportar erro</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'desenvolvedores' %}"><img src="{% static 'icones-site/desenvolvedores.png' %}" alt="">Desenvolvedores</a></li>
                        <li><a href="{% url 'sobre_habitus' %}"><img src="{% static 'icones-site/sobre.png' %}" alt="">Sobre o Habitus</a></li>
                    </div>
                </ul>
            </nav>

        {% elif user.groups.first.name == "Admin" %}
            <!-- MENU PARA ADMIN -->
            <nav id="menu-lateral" class="menu-lateral">
                <div class="fechar">
                    <h1>Menu</h1>
                    <button class="fechar-menu" onclick="toggleMenu()">✕</button>
                </div>
                <ul>
                    <div>
                        <li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/ultimas-noticias.png' %}" alt="">Últimas notícias</a></li>
                        <li><a href="{% url 'notificacoes' %}"><img src="{% static 'icones-site/notificacoes.png' %}" alt="">Notificações</a></li>
                        <li><a href="{% url 'historico' %}"><img src="{% static 'icones-site/historico.png' %}" alt="">Histórico</a></li>
                        <li><a href="{% url 'solicitar_novo_treino' %}"><img src="{% static 'icones-site/solicitar-treino.png' %}" alt="">Solicitar novo treino</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'gerenciar_alunos' %}"><img src="{% static 'icones-site/icone-alunos.png' %}" alt="">Alunos</a>
                        <li><a href="{% url 'exercicios' %}"><img src="{% static 'icones-site/icone-exercicios.png' %}" alt="">Exercícios</a></li>
                        <li><a href="{% url 'gerenciar_noticias' %}"><img src="{% static 'icones-site/icone-noticias.png' %}" alt="">Notícias</a></li>
                        <li><a href="{% url 'professores' %}"><img src="{% static 'icones-site/icone-professores.png' %}" alt="">Professores</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'configuracoes' %}"><img src="{% static 'icones-site/configuracoes.png' %}" alt="">Configurações</a></li>
                        <!--<li><a href="{% url 'feed' %}"><img src="{% static 'icones-site/icone-avaliar.png' %}" alt="">Avaliações</a></li>-->
                        <li><a href="{% url 'reportar_erro' %}"><img src="{% static 'icones-site/reportar-erro.png' %}" alt="">Reportar erro</a></li>
                    </div>
                    <div>
                        <li><a href="{% url 'desenvolvedores' %}"><img src="{% static 'icones-site/desenvolvedores.png' %}" alt="">Desenvolvedores</a></li>
                        <li><a href="{% url 'sobre_habitus' %}"><img src="{% static 'icones-site/sobre.png' %}" alt="">Sobre o Habitus</a></li>
                    </div>
                </ul>
            </nav>
        {% endif %}
    {% endif %}
    <main>
    <section class="nome-pagina">
        <h1>Professor</h1>
    </section>
    <section class="container">

        <div class="foto-container">
            <label for="foto-upload" class="foto-wrapper">
                <img id="foto-professor" 
                     src="{% if professor.foto_perfil %}{{ professor.foto_perfil.url }}{% else %}{% static 'icones-site/sem-foto.png' %}{% endif %}" 
                     alt="Foto de {{ professor.nome }}" 
                     class="foto-perfil">
            </label>

            <form id="foto-form" method="post" action="{% url 'atualizar_foto_professor' pk=professor.pk %}" enctype="multipart/form-data" style="display: none;">
                {% csrf_token %}
                <input type="file" id="foto-upload" name="foto" accept="image/*" required>
            </form>
        </div>

<!-- Mensagem flutuante -->
        <div id="foto-message" class="foto-message"></div>

        

        <h2>{{ professor.nome }}</h2>
        <p>Professor(a)</p>


        <section class="dados-pessoais">
            <h3>Dados pessoais</h3>
            <p>Nome: </p>
            <p>{{ professor.nome }}</p>
            <div>
                <div>
                    <p>Matrícula: </p>
                    <p>{{ professor.matricula }}</p>
                </div>
                <div>
                    <p>Usuário: </p>
                    <p>{{ professor.user }}</p>
                </div>
            </div>
            <div>
                <div>
                    <p>CPF: </p>
                    <p>{{ professor.cpf }}</p>
                </div>
                <div>
                    <p>Telefone: </p>
                    <p>{{ professor.telefone }}</p>
                </div>
            </div>
            <p>E-mail: </p>
            <p>{{ professor.user.email }}</p>
            <p>Senha: </p>
            <p> *** </p>
           
        </section>

        <section class="dados-profissionais">
            <h3>Dados profissionais</h3>
            <div>
                <div>
                    <p>Tipo de contrato: </p>
                    <p>{{ professor.get_tipo_trabalho_display }}</p>
                </div>
                <div>
                    <p>Data de admissão: </p>
                    <p>{{ professor.data_admissao|date:"d/m/Y" }}</p>
                </div>
            </div>
            
            <p>Instituição de formação: </p>
            <p>{{ professor.inst_formacao }}</p>
        </section>

        <div class="botoes">
            <form id="status-form" method="post" action="{% url 'inativar_reativar_professor' professor.pk %}" style="display: inline;">
                {% csrf_token %}
                {% if professor.user.is_active %}
                    <button type="button" class="inativar" onclick="confirmarAcao('inativar')">Inativar conta</button>
                {% else %}
                    <button type="button" class="reativar" onclick="confirmarAcao('reativar')">Reativar conta</button>
                {% endif %}
            </form>
            <a href="{% url 'editar_professor' professor.pk %}"><button class="editar">Editar dados</button></a>
        </div>
        
    </section>

    <menu>
        <div>
            <a href="{% url 'feed' %}">
                <img src="{% static 'icones-site/feed-icon-preta.png' %}" alt="Logo feed">
                <h3>Feed</h3>
            </a>
        </div>
        <div>
            <a href="{% url 'treinos' %}">
                <img src="{% static 'icones-site/treino-icon-preta.png' %}" alt="icone treino">
                <h3>Treinos</h3>
            </a>
        </div>
        <div>
            <a href="{% url 'perfil' %}">
                <img src="{% static 'icones-site/perfil-icon-preta.png' %}" alt="Logo perfil">
                <h3>Perfil</h3>
            </a>
        </div>
    </main>
    
    </menu>
</body>
</html>
